---
import { useState, useEffect } from 'react';
import Navbar from '../components/Navbar.astro';

const [carta, setCarta] = useState(null);

useEffect(() => {
  const guardada = localStorage.getItem('cartaDia');
  const fechaGuardada = localStorage.getItem('fechaCarta');
  const hoy = new Date().toISOString().slice(0, 10);

  if (guardada && fechaGuardada === hoy) {
    setCarta(JSON.parse(guardada));
  }
}, []);

const obtenerCarta = async () => {
  const hoy = new Date().toISOString().slice(0, 10);

  const res = await fetch('/cartas_tarot_es.json');
  const cartas = await res.json();
  const aleatoria = cartas[Math.floor(Math.random() * cartas.length)];

  localStorage.setItem('cartaDia', JSON.stringify(aleatoria));
  localStorage.setItem('fechaCarta', hoy);

  setCarta(aleatoria);
};
---

<html lang="es">
  <head>
    <title>Carta del D√≠a ‚Äì Luna Journal</title>
    <meta charset="UTF-8" />
  </head>
  <body style="
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(to bottom, #1e1b2e, #2e2649);
    color: #f4e2d8;
    margin: 0;
    min-height: 100vh;
  ">
    <Navbar />
    <main style="padding: 2rem; max-width: 600px; margin: auto; text-align: center;">
      <h1 style="font-size: 2rem;">üÉè Tu carta del d√≠a</h1>

      {!carta && (
        <button
          onClick={() => obtenerCarta()}
          style="margin-top: 1.5rem; padding: 0.75rem 1.5rem; border: none;
                 background-color: #f4e2d8; color: #2e2649; border-radius: 8px;
                 font-size: 1rem; cursor: pointer;">
          Dame la carta del d√≠a
        </button>
      )}

      {carta && (
        <div style="margin-top: 2rem; background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 12px;">
          <h2 style="margin-bottom: 0.5rem;">{carta.nombre}</h2>
          <p><strong>Significado:</strong> {carta.descripcion}</p>
          <p><strong>Consejo:</strong> <em>{carta.consejo}</em></p>
        </div>
      )}
    </main>
  </body>
</html>
